# 3d-inventory-oracle-api

- [3d-inventory-oracle-api](#3d-inventory-oracle-api)
  - [Overview](#overview)
    - [Running the server](#running-the-server)
    - [Swagger](#swagger)
    - [Setup Database](#setup-database)
  - [Run Oracle DB in container](#run-oracle-db-in-container)
    - [Shell](#shell)
    - [Podman](#podman)
  - [Test JSON structure in 19.3g](#test-json-structure-in-193g)

[![wakatime](https://wakatime.com/badge/user/3bbeedbe-0c6a-4a01-b3cd-a85d319a03bf/project/018c3018-efe9-4b33-a2ed-9fafa58710f7.svg)](https://wakatime.com/badge/user/3bbeedbe-0c6a-4a01-b3cd-a85d319a03bf/project/018c3018-efe9-4b33-a2ed-9fafa58710f7)
[![GitHub latest commit](https://badgen.net/github/last-commit/karol-preiskorn/3d-inventory-oracle-api)](https://GitHub.com/karol-preiskorn/3d-inventory-oracle-api/commit/)
[![GitHub stars](https://img.shields.io/github/stars/karol-preiskorn/3d-inventory-oracle-api.svg?style=social&label=Star&maxAge=2592000)](https://GitHub.com/karol-preiskorn/3d-inventory-oracle-api/stargazers/)
[![GitHub issues](https://img.shields.io/github/issues/karol-preiskorn/3d-inventory-oracle-api.svg)](https://GitHub.com/karol-preiskorn/3d-inventory-oracle-api/issues/)
[![MIT license](https://img.shields.io/badge/License-MIT-blue.svg)](https://lbesson.mit-license.org/)
[![TypeScript](https://img.shields.io/badge/--3178C6?logo=typescript&logoColor=ffffff)](https://www.typescriptlang.org/)
[![Npm](https://badgen.net/badge/icon/npm?icon=npm&label)](https://https://npmjs.com/)
[![GitHub license](https://badgen.net/github/license/karol-preiskorn/3d-inventory-oracle-api)](https://github.com/karol-preiskorn/3d-inventory-oracle-api/blob/master/LICENSE)

Part of [3d-inventory project](https://github.com/users/karol-preiskorn/projects/2/views/2).

- [3d-inventory-angular-ui](https://GitHub.com/karol-preiskorn/3d-inventory-angular-ui/)
- [3d-inventory-oracle-api](https://GitHub.com/karol-preiskorn/3d-inventory-oracle-api/)
- [3d-inventory-mongo-api](https://GitHub.com/karol-preiskorn/3d-inventory-mongo-api/)

## Overview

This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the [OpenAPI-Spec](https://github.com/OAI/OpenAPI-Specification) from a remote server, you can easily generate a server stub.

- Simple commonjs (backend) api depends on oracledb
- Generated by Swagger v3.
- API is in `/src`
- Oracle db in docker (statefull)

### Running the server

To run the API server:

```bash
npm run api-install
npm run nodemon
```

To view the Swagger UI interface:

```bash
open http://localhost:8080/docs
```

This project leverages the mega-awesome [swagger-tools](https://github.com/apigee-127/swagger-tools) middleware which does most all the work.

### Swagger

#### OpenAPI definition 3.0.3

https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md#componentsObject

#### NPM run

1. Make backup `npm run swagger:backup-before-generate` --> `cp -v ./src/service/* ./backup`
2. Update jars `swagger:get-jars`
3. Generate api by docker `swagger:v3-docker-generate`
4. Edit openapi by swagger editor: `swagger:v3-editor` and `swagger:v3-editor-open`
5. Generate api by jars `swagger:v3-generate`

### Setup Database

When run in `podman` db create at `172.17.0.2`. To connect db i use Oracle `SQLcl`.

After your service is created, you can connect to it via the following properties:

    Hostname:
        oracle (from within another container)
        localhost or 127.0.0.1 (from the host directly)
    Port: 1521
    Service name: FREEPDB1
    Database App User: my_user
    Database App Password: password_i_should_change


```bash
$ ./sql sys/3dinventory@127.0.0.1:1521/FREEPDB1 as sysdba
```

#### Set password

```bash
# call shell
docker exec -it 5c6a4a0c10638e88b0d1a5e35867ed908b78d8dc7fae4df804fc8cbcf1d78921 sh
# change password
docker exec -d 5c6a4a0c1063 ./setPassword.sh babilon5
# run some other command in container like sql scripts
docker exec -ti 5c6a4a0c1063 sh -c "echo a && echo b"
sql sys/babilon5@172.17.0.2:1521/orclpdb1 as sysdba
```

#### Use image of DB

This images have more options to configure pass and faststart: https://hub.docker.com/r/gvenzl/oracle-xe

I use `db-oracle-21-faststart` simple as this:

```bash
docker run -d -p 1521:1521 -e ORACLE_PASSWORD=babilon5 \
           -v oracle-volume:/opt/oracle/oradata \
           gvenzl/oracle-xe:21.3.0-faststart
```

## Run Oracle DB in container

### Shell

```bash
podman run -d -p 1521:1521 -e ORACLE_PASSWORD=3dinventory docker://gvenzl/oracle-free
sqlplus sys/LetsTest1@localhost/XE as sysdba
```

### Podman

```bash
podman exec -ti oracle-xe sqlplus sys/LetsTest1@localhost/XE as sysdba
```

#### Create test database and test user

```sql
CREATE PLUGGABLE DATABASE test ADMIN USER test IDENTIFIED BY LetsTest1 FILE_NAME_CONVERT=('pdbseed','test');
ALTER PLUGGABLE DATABASE test OPEN;
ALTER PLUGGABLE DATABASE test SAVE STATE;
ALTER SESSION SET CONTAINER=test;
GRANT CONNECT, RESOURCE, CREATE VIEW, UNLIMITED TABLESPACE TO test;
exit;
```

## Test JSON structure in 19.3g

1. Create instance db from offical build: [19.3.0](
https://github.com/oracle/docker-images/tree/main/OracleDatabase/SingleInstance/dockerfiles/19.3.0)
2. 
